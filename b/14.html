<!DOCTYPE HTML>
<html>
<head>

    <title>lojikil</title>

    <link rel="stylesheet" href="/style.css" type="text/css" media="screen, handheld" title="default">

    <meta charset="UTF-8">
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"> 
</head>
<body>

<div id="header">
    <div class="superHeader">
    <div class="left">
        <a href="/">home</a> |
        <a href="https://twitter.com/lojikil">twitter</a> |
        <a href="https://github.com/lojikil">github</a> |
        <a href="https://lobste.rs/u/lojikil">lobste.rs</a>
    </div>

    <div class="right">
      <span class="doNotDisplay">Related sites:</span>
       <a href="http://lojikil.com">self-hosted site</a>
    </div>

    </div>

    <div class="midHeader">
    <h1 class="headerTitle"><a href="/">lojikil <span id="headerSubTitle">purveyors of fine, internet-related kipple, since 1985</span></a></h1>
    </div>
    
    <div class="subHeader"><br></div>
</div>
  <div id="side-bar">
    <div>
      <ul>
    <li> <a href="/t">&rsaquo; t </a></li>
    <li> <a href="/d">&rsaquo; d </a></li>
    <li> <a href="/b">&rsaquo;  b </a></li>
    <li>
      <ul>
      </ul>
    </li>
    <li> <a href="/p">&rsaquo; p </a></li>
    <li> <a href="/w">&rsaquo; w </a></li>
      </ul>
    </div>
  </div>


  <div id="main-copy">
<h1 id="_six_to_seven_months_of_coastal_living_coastml_status_report_for_september_2022">six to seven months of coastal living: coastML status report for September 2022</h1>
<p>Today marks seven-ish months of coastal living; let’s checkout the running burndown chart:</p>
<ul>
<li><p>✓ assignments</p></li>
<li><p>✓ functions</p></li>
<li><p>✓ <code>case</code> forms</p>
<ul>
<li><p>✓ thread assignments into <code>case</code> forms (e.g. <code>a = case x …​</code> becomes <code>case x | …​ { a = …​ }</code>)</p></li>
<li><p>✓ <code>case</code> forms within other forms, such as function calls</p></li>
</ul></li>
<li><p>✓ <code>type</code> forms</p></li>
<li><p>✓ Python generation</p></li>
<li><p>✓ decomposition in <code>case</code> forms</p>
<ul>
<li><p>✓ including pattern matching</p></li>
<li><p>❏ array pattern matching</p></li>
<li><p>❏ string pattern matching (this could get interesting…​)</p></li>
</ul></li>
<li><p>✓ accessors (both variables and lambdas) for <code>type</code></p></li>
<li><p>❏ <code>gn</code> forms</p></li>
<li><p>❏ <code>fc</code> forms</p>
<ul>
<li><p>Still <strong>so</strong> on the fence about these…​</p></li>
</ul></li>
<li><p>❏ <code>mod</code> and <code>sig</code> forms</p></li>
<li><p>❏ an analog to SML’s <code>op</code>, using backticks</p></li>
<li><p>❏ basis library (stubbed out, need to actually compile)</p>
<ul>
<li><p>✓ basic basis stubs: some members of <code>array-*</code>, <code>string-*</code> have been stubbed out</p>
<ul>
<li><p>✓ array-length</p></li>
<li><p>✓ array-get</p></li>
<li><p>✓ array-set!</p></li>
<li><p>✓ array-make</p></li>
<li><p>✓ array-init</p></li>
<li><p>✓ array-make-matrix</p></li>
<li><p>✓ array-append</p></li>
<li><p>✓ array-append!</p></li>
<li><p>❏ array-concat</p></li>
<li><p>❏ array-concat!</p></li>
<li><p>✓ array-sub</p></li>
<li><p>✓ array-copy</p></li>
<li><p>❏ array-fill!</p></li>
<li><p>❏ array-blit!</p></li>
<li><p>❏ array→list</p></li>
<li><p>❏ list→array</p></li>
<li><p>✓ array-iter</p></li>
<li><p>✓ array-map</p></li>
<li><p>✓ array-iter-index</p></li>
<li><p>✓ array-map-index</p></li>
<li><p>❏ array-foldl</p></li>
<li><p>❏ array-foldr</p></li>
<li><p>❏ array-sort</p></li>
<li><p>✓ array-sort!</p></li>
<li><p>❏ array-stable-sort</p></li>
<li><p>❏ array-fast-sort</p></li>
<li><p>✓ string-length</p></li>
<li><p>✓ string-get</p></li>
<li><p>❏ string-make</p></li>
<li><p>❏ string-init</p></li>
<li><p>✓ string-split</p></li>
<li><p>✓ string-append</p></li>
<li><p>❏ string-join</p></li>
<li><p>❏ string-contains</p></li>
<li><p>❏ string-concat</p></li>
<li><p>❏ string-copy</p></li>
<li><p>❏ string→array</p></li>
<li><p>✓ string-iter</p></li>
<li><p>✓ string-map</p></li>
<li><p>✓ string-iter-index</p></li>
<li><p>❏ string-map-index</p></li>
<li><p>❏ string-foldl</p></li>
<li><p>❏ string-foldr</p></li>
<li><p>✓ string-sort</p></li>
<li><p>❏ compare</p></li>
<li><p>❏ char-code</p></li>
<li><p>❏ char-chr</p></li>
<li><p>❏ char-escaped</p></li>
<li><p>❏ char-lowercase</p></li>
<li><p>❏ char-uppercase</p></li>
<li><p>❏ char-compare</p></li>
<li><p>More of the OS interaction stuff out of <a href="https://reasonml.github.io/api/Pervasives.html">the Pervasives API</a></p></li>
</ul></li>
<li><p>❏ basis library modules (modular forms, e.g. <code>array-get</code> becomes <code>Array::get</code>)</p></li>
</ul></li>
<li><p>❏ support for the <code>is</code> form</p></li>
<li><p>❏ code generation</p>
<ul>
<li><p>❏ C</p></li>
<li><p>❏ C++</p></li>
<li><p>❏ Go</p></li>
<li><p>✓ Python</p></li>
<li><p>✓ JavaScript</p></li>
</ul></li>
<li><p>❏ type inference</p></li>
<li><p>❏ refinement types</p></li>
<li><p>❏ a compiler</p>
<ul>
<li><p>❏ lambda lifter</p></li>
<li><p>❏ closure conversion</p></li>
<li><p>❏ <code>pragma</code> to control certain aspects of compilation</p></li>
<li><p>❏ checking of accessors prior to compilation</p></li>
<li><p>❏ value restriction for <code>ref</code> types</p></li>
<li><p>✓ checking that functions exist prior to compilation</p></li>
<li><p>✓ checking that <code>case</code> forms use correct constructors</p></li>
</ul></li>
<li><p>bugs fixed</p>
<ul>
<li><p>✓ nested arrays <code>[[[1] [2]] [[3] [4]]]</code></p></li>
<li><p>✓ missing <code>/</code> character in identifier/operator character sets</p></li>
<li><p>✓ floating point numbers with two integral digits (e.g. <code>0.12</code> and <code>1.12</code> worked but not <code>10.12</code>)</p>
<ul>
<li><p>this was noticed when attempting to write some software to generate <a href="https://en.wikipedia.org/wiki/Julian_day">Julian dates</a></p></li>
<li><p><a href="https://www.subsystems.us/uploads/9/8/9/4/98948044/moonphase.pdf">Was the calculation sheet I was using</a></p></li>
</ul></li>
<li><p>✓ <code>return</code> logic</p>
<ul>
<li><p>❏ there’s more work to be done here at the top level…​</p></li>
</ul></li>
<li><p>✓ indentation of blocks</p></li>
<li><p>✓ missing <code>bool</code> type</p></li>
<li><p>✓ parsing <code>type</code> definitions that have other complex types in them</p></li>
<li><p>✓ munging idents (ex: <code>julian-date</code> becomes <code>julian_date</code>)</p></li>
<li><p>✓ stripping comments prior to output</p>
<ul>
<li><p>really need to handle these so that we can output them into the compiled language, but for now this suffices</p></li>
</ul></li>
<li><p>✓ <code>return</code> prepended to forms that are rewritten to <code>for</code> loops</p></li>
<li><p>✓ fix spacing between <code>class</code> forms in Python output</p></li>
<li><p>✓ fixed bugs with parsing &amp; displaying characters</p></li>
<li><p>❏ <code>case</code> forms at the start of a <code>(call)</code> form are assumed to be functions instead of evaluated for a lambda</p>
<ul>
<li><p><code>(case …​ | 10 { " " } | _ { "nope" } esac …​)</code> is assumed to be a lambda already…​ whoops</p></li>
</ul></li>
<li><p>✓ <code>case</code> forms in a function call in assignment clobbers the assignment</p>
<ul>
<li><p>ex: <code>a = string-split-char ':' case (OS::getenv "PATH") | (Result.Some s) { s } | (Result.None) { "" } esac;</code></p></li>
<li><p>produces <code>a = res1 = …​</code> which is obviously in correct</p></li>
</ul></li>
<li><p>✓ <code>case</code> forms that destructure <code>type</code> forms don’t indent correctly and don’t nest <code>if-elif-else</code> correctly</p></li>
<li><p>✓ <code>case</code> forms that bind a function call do not indent the initial <code>if</code> correctly</p></li>
<li><p>✓ destructuring binds didn’t actually apply a <code>.format</code> correctly</p></li>
<li><p>✓ indentation more generally is handled better</p></li>
</ul></li>
</ul>
<p>So we’ve added quite a bit of code these last two months…​ some personal things came up that delayed writing August’s blog post, but I’ve continued hacking away at things as needed. Little ticky-tacky bugs aside, there’s two new major modules within the system: a <code>Compiler</code> and <code>CarpetJavaScript</code>.</p>
<p>The first lifts many of the AST → AST forms that were previously within the <code>CarpetPython</code> module. These transforms are useful to multiple code generators, and honestly should be above that sort of level. The compiler now checks for function existence, the validity of <code>case</code> arms, and does various transforms on code, such as lifting lambdas. It’s also just about at the point where it can be used to check the body of <code>fn</code> forms as well; the last step there is just to start collecting a spaghetti stack of environments.</p>
<p>The second is just a straight-forward coastML → JavaScript code generator. There are still some forms I need to flesh out, such as various pervasives, but the general shape is coming together. It’s been interesting to consider another language, since that generally forces you into a good structure for where other AST-level transforms should live. The next step will be adding types, so that languages like Golang become easier, and so that we can annotate JavaScript &amp; Python with typing information as well.</p>
<p>Lastly, I exposed the <code>Compiler</code> as a command on the command line:</p>
<pre><code>% ./coastml
usage: carpet.py [command] [file]
commands:
load - load a file, and dump the resulting coastML
compile - like load, but run the compiler too
python - dump python from a coastML file, without the compiler
cpython - dump python from a coastML file, with the compiler
javascript - dump javascript from a coastML file
note, the last two will be merged at some point</code></pre>
<p>This next month, I want to focus on the Compiler as well as the basis library, so that we can get some really great code together, and start generating code from coastML that we deliver to other teams.</p>
  </div>
  </body>
</html>
