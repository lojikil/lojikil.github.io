<html>
  <head>
    <title>&#923;ojiki&#955; | index</title>
    <link rel="stylesheet" href="/main.css" type="text/css">
  </head>
  <body>
    <pre>
 _       _ _ _    _ _ 
| |     (_|_) |  (_) |
| | ___  _ _| | ___| |
| |/ _ \| | | |/ / | |
| | (_) | | |   &lt;| | |
|_|\___/| |_|_|\_\_|_|
       _/ |           
      |__/           
    purveyors of fine, internet-related kipple since 1985.
    </pre>
    <hr>
<a href="/p/">p</a> &raquo; <a href="/p/lpn/">lpn</a> &raquo; <a href="/p/lpn/3/">3</a> &raquo; <a href="/p/lpn/3/index.txt">index.txt</a>
<br>
So, this is one of my more, uh, interesting adventures.
<br>
Basically, my laptop at <span class="muse-bold">work</span> (edit: spelling; thanks Lord of the Dance!) died, and our fear-less admin (and resident Lord of the Dance) requested that I try Western Digital's hard disk analyzer. Well, 
interestingly enough, that utility requires a FreeDOS install, which I put on a spare 1GiB USB stick. Well, that got me thinking: what else can I do with a spare 
FreeDOS install? Well, I can put FreePascal on it! That would make it super useful!
<br>
So, thus armed, I set out to write some neat stuff for FreeDOS... and promptly hit a wall: the FreePascal IDE wouldn't load! I don't recall what the error was, but
naturally my next step was to check if the <span class="muse-italic">compiler</span> would work, which it did. "Well, that should be enough..."
<br>
My First step was a simple "hello world!" type of program:
<br>
<pre class="muse-code">program foo;
begin
    writeln("Hello, world");
end.</pre><br>
<br>
Can you spot the bug? Suffice it to say that I haven't written Pascal in some time, &amp; forgot that Strings are ' ' delimited rather than " " delimited; the above
was quickly followed by:
<br>
<pre class="muse-code">program bar;
begin
    writeln('Hello, world!');
end.</pre><br>
<br>
The fun part about this is that I wrote them line-by-line using <code class="muse-code">GECHO</code>; the built in DOS-echo didn't handle strings properly. 
<br>
(Although, thinking about it, I wonder if I could have used something like <code class="muse-code">TYPE CON</code>... Have to try that later). Basically I wrote way too many lines of:
<br>
<pre class="muse-code">C:\WORK&gt;\fpc\bin\go32v2\gecho "program foo;" &gt; foo.pas
C:\WORK&gt;\fpc\bin\go32v2\gecho "begin" &gt;&gt; foo.pas
...</pre><br>
<br>
As you may imagine, that was slow going :D
<br>
Having written a "Hello, world" that I could compile, my next thought was to write something akin to <code class="muse-code">cat</code>, where it would read from <code class="muse-code">STDIN</code> (or <code class="muse-code">Input</code> in Pascal) and
write to <code class="muse-code">STDOUT</code>. I don't know if I screwed something up, but <code class="muse-code">EOF</code> was <span class="muse-bold">not</span> working for me (I would hit <code class="muse-code">^Z</code> and it would keep going; I probably mistyped something),
so my <code class="muse-code">cat</code> replacement reads until it hits <code class="muse-code">.</code> byitself on a line, like <code class="muse-code">ed</code> does:
<br>
<pre class="muse-code"> program dog(input, output);
var s: string;
begin
    readln(s);
    while s &lt;&gt; '.' do 
    begin
        writeln(s);
        readln(s);
    end;
end.</pre><br>
<br>
The code is simple, and I hand formatted it, but mostly so that I could attempt to read it later. Personally, I like the <span class="muse-bold">idea</span> of Pascal/Algol, but I do find the
lack of symbols a bit disorienting at times, so I <span class="muse-bold">do</span> like to have it nicely formatted.
<br>
Armed with <span class="muse-italic">that</span> code, I set out to write a simple prompt test:
<br>
<pre class="muse-code"> program prompttest(input, output);
var
    s : string;
begin
    write('&gt; ');
    readln(s);
    while s &lt;&gt; 'q' do
    begin
        writeln('s is ', s);
        write('&gt; ');
        readln(s);
    end;
end.</pre><br>
<br>
Having written that, I finally set out to write a very basic editor, which I dubbed "ZDLIN". I can't tell you how many times I had to type this in; after
getting the <code class="muse-code">p</code> and <code class="muse-code">i</code> commands to work, it was a devil of a time to retype the whole thing in order to add commands. I was thinking about adding a handful of
other small utilities, like <code class="muse-code">head</code> and <code class="muse-code">tail</code>, to help with the process, but eventually I just soldiered on &amp; wrote it out:
<br>
<pre class="muse-code">program zdlin(input, output);
uses
    Classes, SysUtils;
var
    buffer : TStringList;
    line, src : string;
    idx, tmp0, tmp1, tmp2 : integer;
begin
    buffer := TStringList.create;
    src := ParamStr(1);
    buffer.LoadFromFile(src);
    idx := buffer.count - 1;
    write('&gt; ');
    readln(line);
    while line &lt;&gt; 'q' do
    begin
        if line = 'p' then
        begin
            if idx &gt; 0 then
            begin
                for tmp0 := 0 to idx do
                begin
                    writeln(buffer[tmp0]);
                end;
            end;
        end
        else if line = 'P' then // should prompt for a range
        begin
            if idx &gt; 0 then
            begin
                for tmp0 := 0 to idx do
                begin
                    writeln(inttostr(tmp0),': ', buffer[tmp0]);
                end;
            end;
        end
        else if line = 'd' then
        begin
            write('at: ');
            readln(line);
            Val(line, tmp0, tmp1);
            buffer.delete(tmp0);
            Dec(idx);
        end
        else if line = 'D' then
        begin
            write('start: ');
            readln(line);
            Val(line, tmp0, tmp1);
            write('end: ');
            readln(line);
            Val(line, tmp1, tmp2);
            for tmp2 := tmp0 to tmp1 do
            begin
                buffer.delete(tmp0); // buffer shrinks each time
            end;
            idx := buffer.count - 1;
        end
        else if line = 'I' then
        begin
            write('at: ');
            readln(line);
            Val(line, tmp0, tmp1);
            readln(line);
            tmp1 := tmp0;
            while line &lt;&gt; '.' do
            begin
                buffer.insert(tmp0, line);
                Inc(tmp0);
                readln(line);
            end;
            Inc(idx, tmp0 - tmp1);
        end
        else if line = 'i' then
        begin
            readln(line);
            while line &lt;&gt; '.' do
            begin
                idx := buffer.add(line);
                readln(line);
            end;
        end
        else
            writeln('Unknown command: ', line);
        write('&gt; ');
        readln(line);
    end;
    buffer.SaveToFile(src);
    buffer.Free;
end.</pre><br>
<br>
 As you can see, there is no command parsing what so ever; commands are simply <code class="muse-code">p</code> or <code class="muse-code">P</code>, and the user is then prompted for any other parameters as necessay. Though
basic, it <span class="muse-bold">should</span> be enough to implement <a href="https://twitter.com/bigthingist/status/454454027418230784">Bigthingist's</a> idea, and make something more visual. Of course,
as I replied, I <span class="muse-italic">would</span> be interested in trying to make something <a href="http://en.wikipedia.org/wiki/Sam_(text_editor)">Sam-like</a> as a test. And, of course, I'd like to
make a Digamma Runtime; Retargetting Enyalios for FreePascal shouldn't be <span class="muse-bold">too</span> difficult; I'd be more concerned about it being too large for memory though :D
<br>
The files mentioned above can be downloaded below:
<br>
<ul>
<li> <a href="FOO.PAS">FOO</a></li>
<li> <a href="BAR.PAS">BAR</a></li>
<li> <a href="DOG.PAS">DOG</a></li>
<li> <a href="PRMTST.PAS">PRMTST</a></li>
<li> <a href="ZDLIN.PAS">ZDLIN</a></li>
</ul>


    <hr>
    <a href="/">Home</a> |
    <a href="/about/"> About</a> |
    <a href="/b/">Blag</a> |
    <a href="/p/lpn/">Lojikil's Programmer Notebook</a> |
    <a href="/p/"> Projects</a> |
    <a href="https://twitter.com/lojikil">Twitter</a> |
    <a href="https://github.com/saedwards-ecc">Github</a> |
    <a href="https://bitbucket.org/saedwards">BitBucket</a>
  </body>
</html>
